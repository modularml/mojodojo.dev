import{_ as r,c,a as o,b as n,d as l,e as a,f as i,r as p,o as y}from"./app-CGzBYgfx.js";const F="/assets/fire-DMr7LRvj.png?version=93",D="/assets/blue-fire-LoQhC9kP.png?version=111",A="/assets/blurred-BxQfQJ8y.jpg",d="/assets/filter2D-D6-KgfnM.jpg?version=4",h="/assets/mojo-blur-BDQsptbv.png",g={};function m(B,s){const e=p("RouteLink"),t=p("CommentService");return y(),c("div",null,[s[8]||(s[8]=o(`<p><em>I wrote this blog before I started working at Modular, these views are not representative of Modular</em></p><h1 id="rust-or-mojo-for-the-future-of-ai" tabindex="-1"><a class="header-anchor" href="#rust-or-mojo-for-the-future-of-ai"><span>Rust or Mojo for the future of AI?</span></a></h1><h2 id="intro" tabindex="-1"><a class="header-anchor" href="#intro"><span>Intro</span></a></h2><p>There has been dissatisfaction with the combination of C/C++ and Python for putting ML models into production, debugging problems when something goes wrong can be a nightmarish task. Ideally we could have one language that allows systems programmers to squeeze our hardware to the limits of physics, while also being suitable as a safe high level language to make putting code into production easy, reliable and performant. Rust fits that space well despite having a steep learning curve, and it&#39;s starting to be noticed in the industry as a potential solution.</p><p>Converting production code that uses computer vision ML models from C/C++/Python to Rust is a nice experience on the surface, Rust works well as a high-level, safe and expressive language with very low performance overhead. But the ecosystem is still young, and so we still rely on huge C++ projects like opencv, which itself relies on huge C++ projects like ffmpeg for image and video encoding and decoding. The experience of linking to these libraries can be quite painful, especially statically, and squeezing performance out of SIMD registers or other specialized hardware requires even more complexity. It begins to feel redundant when you end up with hundreds of megabytes of <code>.so</code> dependencies while wrapping C/C++ in unsafe Rust.</p><h2 id="c-dependencies" tabindex="-1"><a class="header-anchor" href="#c-dependencies"><span>C++ Dependencies</span></a></h2><p>There is an ongoing attempt to <a href="https://github.com/rust-cv/cv/graphs/contributors?from=2019-05-05&amp;to=2019-05-17&amp;type=c" target="_blank" rel="noopener noreferrer">rewrite opencv functionality</a> in Rust but it hasn&#39;t picked up much steam since it was introduced in 2019 with very little activity now, and it only really scratches the surface. Many are using <a href="https://github.com/twistedfall/opencv-rust" target="_blank" rel="noopener noreferrer">opencv-rust C++ bindings</a> which are maintained by a dedicated, but mostly solo contributor. It gives you everything needed for computer vision, including the aforementioned ffmpeg to decode video and get frames into a tensor. Then, to boost performance on ML models, the fastest solution in my benchmarks was to convert TensorFlow and PyTorch models to ONNX and use libonnxruntime bindings from a crate named <a href="https://github.com/pykeio/ort" target="_blank" rel="noopener noreferrer">ort</a>. There is a good Rust native implementation named <a href="https://github.com/sonos/tract" target="_blank" rel="noopener noreferrer">tract-onnx</a>, but it doesn&#39;t have many contributors, so it is missing operators, is slow with some operators, and only runs on CPU. The <a href="https://github.com/pykeio/ort" target="_blank" rel="noopener noreferrer">ort</a> fork of the original outdated libonnxruntime bindings is faster for all the models I&#39;ve benchmarked, plus the <code>libonnxruntime.so</code> dependency is very small and easy to statically link, and some larger companies like Twitter have started using it.</p><h2 id="c-from-rust" tabindex="-1"><a class="header-anchor" href="#c-from-rust"><span>C++ from Rust</span></a></h2><p>The tensor representation in opencv is a <code>Matrix</code>, a bit of a misnomer as it can contain more than 2 dimensions. <code>ort</code> uses a Rust native crate named <code>ndarray</code> for it&#39;s tensor type, they both have the same C row-major representation in memory, so we can get performance improvements by dipping into unsafe Rust and bitcasting the Rust native <code>ndarray::Array</code> as the C++ native <code>opencv::Matrix</code> without copying any data. However writing <code>unsafe</code> Rust around C++ libraries is <a href="https://zackoverflow.dev/writing/unsafe-rust-vs-zig/" target="_blank" rel="noopener noreferrer">not always the most pleasant experience</a>, and with the vast majority of AI researchers being Python users who aren&#39;t interested in learning Rust, it&#39;s unlikely that it will ever get significant adoption in ML. It&#39;ll never be as ergonomic for researchers as the combination of <code>opencv-python</code>, <code>numpy</code>, <code>pytorch</code> etc.</p><p>What if we could keep the beauty and simplicity of Python as a high level language, and rewrite one function at a time in Mojo to get better performance, removing the complexity and indirections of all the C/C++/Fortran dependencies?</p><h2 id="rewriting-c-c-python-with-mojo" tabindex="-1"><a class="header-anchor" href="#rewriting-c-c-python-with-mojo"><span>Rewriting C/C++/Python with Mojo</span></a></h2><p>Instead of adding more complexity on top of C++, let&#39;s see how we can use Mojo to simplify things and get even faster performance.</p><p>Currently Mojo is only available from an online Jupyter notebook (local release should be in the next few months), so to benchmark we&#39;re going to need to need to run Python from the same notebook environment.</p><p>We&#39;ll be taking a png of a fire emoji, manually implementing a box blur in python, then using an optimized opencv function, and rewriting it in Mojo to remove all the underlying C/C++/OpenCL complexity.</p><p>In Mojo we can use any library from the entire Python ecosystem, so we&#39;ll use opencv to get our images into a numpy array and matplotlib to render them:</p><div class="language-python" data-highlighter="prismjs" data-ext="py" data-title="py"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-python;"><code><span class="line"><span class="line"><span style="color:#7DCFFF;">import</span><span style="color:#A9B1D6;"> cv2</span></span></span>
<span class="line"><span class="line"><span style="color:#7DCFFF;">import</span><span style="color:#A9B1D6;"> numpy </span><span style="color:#7DCFFF;">as</span><span style="color:#A9B1D6;"> np</span></span></span>
<span class="line"><span class="line"><span style="color:#7DCFFF;">from</span><span style="color:#A9B1D6;"> matplotlib </span><span style="color:#7DCFFF;">import</span><span style="color:#A9B1D6;"> colors</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> pyplot </span><span style="color:#7DCFFF;">as</span><span style="color:#A9B1D6;"> plt</span></span></span>
<span class="line"><span class="line"><span style="color:#7DCFFF;">from</span><span style="color:#A9B1D6;"> timeit </span><span style="color:#7DCFFF;">import</span><span style="color:#A9B1D6;"> timeit</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">def</span><span style="color:#7AA2F7;"> write_img</span><span style="color:#9ABDF5;">(</span><span style="color:#E0AF68;">path</span><span style="color:#89DDFF;">,</span><span style="color:#E0AF68;"> img</span><span style="color:#9ABDF5;">):</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">    cv2</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">imwrite</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">path</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> img</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">def</span><span style="color:#7AA2F7;"> open_img</span><span style="color:#9ABDF5;">(</span><span style="color:#E0AF68;">img</span><span style="color:#9ABDF5;">):</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">    img </span><span style="color:#89DDFF;">=</span><span style="color:#A9B1D6;"> cv2</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">imread</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">img</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">astype</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">np</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">uint8</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">    img </span><span style="color:#89DDFF;">=</span><span style="color:#A9B1D6;"> cv2</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">cvtColor</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">img</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> cv2</span><span style="color:#89DDFF;">.</span><span style="color:#FF9E64;">COLOR_RGB2RGBA</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">    return</span><span style="color:#A9B1D6;"> img</span></span></span></code></pre></div><p>There is a image in the same folder as this notebook named <code>fire.png</code>:</p><img src="`+F+`" alt="drawing" width="200"><p>Using <a href="https://marketplace.visualstudio.com/items?itemName=jackos.md-notebook" target="_blank" rel="noopener noreferrer">md-notebook</a> you can access all the previous Python cells from Mojo using the <code>py</code> module:</p><div class="language-mojo" data-highlighter="prismjs" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-mojo;"><code><span class="line"><span class="line"><span style="color:#A9B1D6;">img </span><span style="color:#89DDFF;">=</span><span style="color:#A9B1D6;"> py</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">open_img</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">fire.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;"># Convert from RGB to BGR to color flame blue</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">img </span><span style="color:#89DDFF;">=</span><span style="color:#A9B1D6;"> py</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">cv2</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">cvtColor</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">img</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> py</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">cv2</span><span style="color:#89DDFF;">.</span><span style="color:#FF9E64;">COLOR_RGBA2BGRA</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">py</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">write_img</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">blue-fire.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> img</span><span style="color:#9ABDF5;">)</span></span></span></code></pre></div><img src="`+D+`" alt="drawing" width="200"><div class="language-python" data-highlighter="prismjs" data-ext="py" data-title="py"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-python;"><code><span class="line"><span class="line"><span style="color:#A9B1D6;">img </span><span style="color:#89DDFF;">=</span><span style="color:#7AA2F7;"> open_img</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">fire.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">img</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#89DDFF;">:</span><span style="color:#FF9E64;">4</span><span style="color:#9ABDF5;">])</span></span></span></code></pre></div><div class="language-text" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-text;"><code><span class="line"><span class="line"><span>[255 255 255 255]</span></span></span></code></pre></div><p>The format is: [Red, Green, Blue, Alpha] represented by 8bit unsigned integers.</p><p>Or a middle pixel with some color:</p><div class="language-python" data-highlighter="prismjs" data-ext="py" data-title="py"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-python;"><code><span class="line"><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">img</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">120</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 120</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#89DDFF;">:</span><span style="color:#FF9E64;">4</span><span style="color:#9ABDF5;">])</span></span></span></code></pre></div><div class="language-text" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-text;"><code><span class="line"><span class="line"><span>[ 27 161 252 255]</span></span></span></code></pre></div><p>Let&#39;s try applying a blur using python first:</p><div class="language-python" data-highlighter="prismjs" data-ext="py" data-title="py"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-python;"><code><span class="line"><span class="line"><span style="color:#BB9AF7;">def</span><span style="color:#7AA2F7;"> box_blur</span><span style="color:#9ABDF5;">(</span><span style="color:#E0AF68;">image</span><span style="color:#89DDFF;">,</span><span style="color:#E0AF68;"> diameter</span><span style="color:#9ABDF5;">):</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">    blurred_image </span><span style="color:#89DDFF;">=</span><span style="color:#A9B1D6;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">copy</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">image</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">    height</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> width</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> _ </span><span style="color:#89DDFF;">=</span><span style="color:#A9B1D6;"> image</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">shape</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">    radius </span><span style="color:#89DDFF;">=</span><span style="color:#A9B1D6;"> diameter </span><span style="color:#89DDFF;">//</span><span style="color:#FF9E64;"> 2</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">    for</span><span style="color:#A9B1D6;"> x </span><span style="color:#BB9AF7;">in</span><span style="color:#0DB9D7;"> range</span><span style="color:#9ABDF5;">(</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> height</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">        for</span><span style="color:#A9B1D6;"> y </span><span style="color:#BB9AF7;">in</span><span style="color:#0DB9D7;"> range</span><span style="color:#9ABDF5;">(</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> width</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;">            # Take the average of the pixels in the neighborhood</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">            blurred_image</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">x</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> y</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">mean</span><span style="color:#9ABDF5;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#C0CAF5;">                image</span><span style="color:#9ABDF5;">[</span></span></span>
<span class="line"><span class="line"><span style="color:#0DB9D7;">                    max</span><span style="color:#9ABDF5;">(</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> x </span><span style="color:#89DDFF;">-</span><span style="color:#C0CAF5;"> radius</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">:</span><span style="color:#0DB9D7;">min</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">height</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> x </span><span style="color:#89DDFF;">+</span><span style="color:#C0CAF5;"> radius </span><span style="color:#89DDFF;">+</span><span style="color:#FF9E64;"> 1</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#0DB9D7;">                    max</span><span style="color:#9ABDF5;">(</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> y </span><span style="color:#89DDFF;">-</span><span style="color:#C0CAF5;"> radius</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">:</span><span style="color:#0DB9D7;">min</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">width</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> y </span><span style="color:#89DDFF;">+</span><span style="color:#C0CAF5;"> radius </span><span style="color:#89DDFF;">+</span><span style="color:#FF9E64;"> 1</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#9ABDF5;">                ]</span><span style="color:#89DDFF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#E0AF68;">                axis</span><span style="color:#89DDFF;">=(</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 1</span><span style="color:#89DDFF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#9ABDF5;">            )</span></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">    return</span><span style="color:#A9B1D6;"> blurred_image</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">blurred </span><span style="color:#89DDFF;">=</span><span style="color:#7AA2F7;"> box_blur</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">img</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 8</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#7AA2F7;">write_img</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">blurred.jpg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> blurred</span><span style="color:#9ABDF5;">)</span></span></span></code></pre></div><img src="`+A+`" width="200"><p>This is obviously going to be a very slow operation in Python compared to what you can do in a language like C, let&#39;s time how long it takes:</p><div class="language-python" data-highlighter="prismjs" data-ext="py" data-title="py"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-python;"><code><span class="line"><span class="line"><span style="color:#A9B1D6;">img </span><span style="color:#89DDFF;">=</span><span style="color:#7AA2F7;"> open_img</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">fire.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">python_secs </span><span style="color:#89DDFF;">=</span><span style="color:#7AA2F7;"> timeit</span><span style="color:#9ABDF5;">(</span><span style="color:#BB9AF7;">lambda</span><span style="color:#9ABDF5;">:</span><span style="color:#7AA2F7;"> box_blur</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">img</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 8</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">,</span><span style="color:#E0AF68;"> number</span><span style="color:#89DDFF;"> =</span><span style="color:#FF9E64;"> 5</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;"> /</span><span style="color:#FF9E64;"> 5</span></span></span>
<span class="line"><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">python_secs</span><span style="color:#9ABDF5;">)</span></span></span></code></pre></div><div class="language-text" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-text;"><code><span class="line"><span class="line"><span>0.21889668439980597</span></span></span></code></pre></div><p>The opencv version of the operation uses C++ and one of a few hardware APIs depending on how it was compiled, taking advantage of vectorization. First lets take a look at the result to make sure it&#39;s doing the same thing:</p><div class="language-python" data-highlighter="prismjs" data-ext="py" data-title="py"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-python;"><code><span class="line"><span class="line"><span style="color:#A9B1D6;">img </span><span style="color:#89DDFF;">=</span><span style="color:#7AA2F7;"> open_img</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">fire.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">img </span><span style="color:#89DDFF;">=</span><span style="color:#A9B1D6;"> cv2</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">filter2D</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">img</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> -</span><span style="color:#FF9E64;">1</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">ones</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">(</span><span style="color:#FF9E64;">8</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 8</span><span style="color:#89DDFF;">)</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">/</span><span style="color:#FF9E64;">64</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#7AA2F7;">write_img</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">filter2D.jpg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> img</span><span style="color:#9ABDF5;">)</span></span></span></code></pre></div><img src="`+d+`" width="200"><div class="language-python" data-highlighter="prismjs" data-ext="py" data-title="py"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-python;"><code><span class="line"><span class="line"><span style="color:#A9B1D6;">img </span><span style="color:#89DDFF;">=</span><span style="color:#7AA2F7;"> open_img</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">fire.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">opencv_secs </span><span style="color:#89DDFF;">=</span><span style="color:#7AA2F7;"> timeit</span><span style="color:#9ABDF5;">(</span><span style="color:#BB9AF7;">lambda</span><span style="color:#9ABDF5;">:</span><span style="color:#C0CAF5;"> cv2</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">filter2D</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">img</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> -</span><span style="color:#FF9E64;">1</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">ones</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">(</span><span style="color:#FF9E64;">8</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 8</span><span style="color:#89DDFF;">),</span><span style="color:#C0CAF5;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">uint8</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">/</span><span style="color:#FF9E64;">64</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">,</span><span style="color:#E0AF68;"> number</span><span style="color:#89DDFF;">=</span><span style="color:#FF9E64;">5</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;"> /</span><span style="color:#FF9E64;"> 5</span></span></span>
<span class="line"><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">Seconds:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> opencv_secs</span><span style="color:#9ABDF5;">)</span></span></span></code></pre></div><div class="language-text" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-text;"><code><span class="line"><span class="line"><span>Seconds: 0.0006133885999588529</span></span></span></code></pre></div><p>That&#39;s giving us a very nice speedup over the Python version using C++:</p><div class="language-python" data-highlighter="prismjs" data-ext="py" data-title="py"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-python;"><code><span class="line"><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">Speedup:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> python_secs </span><span style="color:#89DDFF;">/</span><span style="color:#C0CAF5;"> opencv_secs</span><span style="color:#9ABDF5;">)</span></span></span></code></pre></div><div class="language-text" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-text;"><code><span class="line"><span class="line"><span>Speedup: 305.831956407965</span></span></span></code></pre></div><p>Going to the definition of <code>filter2D</code> we find the below code. The <code>...</code> means the C++ functions have default values; these are just for type hints in Python. The overload with <code>UMat</code> is for when you&#39;re using the GPU version of opencv:</p><div class="language-python" data-highlighter="prismjs" data-ext="py" data-title="py"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-python;"><code><span class="line"><span class="line"><span style="color:#51597D;font-style:italic;"># md-notebook:skip</span></span></span>
<span class="line"><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#7AA2F7;">typing</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">overload</span></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">def</span><span style="color:#7AA2F7;"> filter2D</span><span style="color:#9ABDF5;">(</span><span style="color:#E0AF68;">src</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> cv2</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">typing</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">MatLike</span><span style="color:#89DDFF;">,</span><span style="color:#E0AF68;"> ddepth</span><span style="color:#89DDFF;">:</span><span style="color:#0DB9D7;"> int</span><span style="color:#89DDFF;">,</span><span style="color:#E0AF68;"> kernel</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> cv2</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">typing</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">MatLike</span><span style="color:#89DDFF;">,</span><span style="color:#E0AF68;"> dst</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> cv2</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">typing</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">MatLike </span><span style="color:#BB9AF7;">|</span><span style="color:#FF9E64;"> None</span><span style="color:#89DDFF;"> =</span><span style="color:#E0AF68;"> ...</span><span style="color:#89DDFF;">,</span><span style="color:#E0AF68;"> anchor</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> cv2</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">typing</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">Point </span><span style="color:#89DDFF;">=</span><span style="color:#E0AF68;"> ...</span><span style="color:#89DDFF;">,</span><span style="color:#E0AF68;"> delta</span><span style="color:#89DDFF;">:</span><span style="color:#0DB9D7;"> float</span><span style="color:#89DDFF;"> =</span><span style="color:#E0AF68;"> ...</span><span style="color:#89DDFF;">,</span><span style="color:#E0AF68;"> borderType</span><span style="color:#89DDFF;">:</span><span style="color:#0DB9D7;"> int</span><span style="color:#89DDFF;"> =</span><span style="color:#E0AF68;"> ...</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;"> -&gt;</span><span style="color:#A9B1D6;"> cv2</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">typing</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">MatLike</span><span style="color:#9ABDF5;">:</span><span style="color:#E0AF68;"> ...</span></span></span>
<span class="line"><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#7AA2F7;">typing</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">overload</span></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">def</span><span style="color:#7AA2F7;"> filter2D</span><span style="color:#9ABDF5;">(</span><span style="color:#E0AF68;">src</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> UMat</span><span style="color:#89DDFF;">,</span><span style="color:#E0AF68;"> ddepth</span><span style="color:#89DDFF;">:</span><span style="color:#0DB9D7;"> int</span><span style="color:#89DDFF;">,</span><span style="color:#E0AF68;"> kernel</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> UMat</span><span style="color:#89DDFF;">,</span><span style="color:#E0AF68;"> dst</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> UMat </span><span style="color:#BB9AF7;">|</span><span style="color:#FF9E64;"> None</span><span style="color:#89DDFF;"> =</span><span style="color:#E0AF68;"> ...</span><span style="color:#89DDFF;">,</span><span style="color:#E0AF68;"> anchor</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> cv2</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">typing</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">Point </span><span style="color:#89DDFF;">=</span><span style="color:#E0AF68;"> ...</span><span style="color:#89DDFF;">,</span><span style="color:#E0AF68;"> delta</span><span style="color:#89DDFF;">:</span><span style="color:#0DB9D7;"> float</span><span style="color:#89DDFF;"> =</span><span style="color:#E0AF68;"> ...</span><span style="color:#89DDFF;">,</span><span style="color:#E0AF68;"> borderType</span><span style="color:#89DDFF;">:</span><span style="color:#0DB9D7;"> int</span><span style="color:#89DDFF;"> =</span><span style="color:#E0AF68;"> ...</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;"> -&gt;</span><span style="color:#A9B1D6;"> UMat</span><span style="color:#9ABDF5;">:</span><span style="color:#E0AF68;"> ...</span></span></span></code></pre></div><p>Then if you do a search for filter2D in <a href="https://github.com/search?q=repo%3Aopencv%2Fopencv+filter2D&amp;type=code" target="_blank" rel="noopener noreferrer">the opencv C++ source code</a> you&#39;ll find 5 pages of results where <code>filter2D</code> is defined. Likely your version of opencv will be running through OpenCL to take advantage of your CPU SIMD registers, so if you want to contribute a faster version not only will you need to <a href="https://www.nersc.gov/assets/pubs_presos/MattsonTutorialSC14.pdf" target="_blank" rel="noopener noreferrer">figure out how OpenCL works</a>, you&#39;ll also need to learn know how to use SIMD intrinsics from C++ as a fallback.</p><p>There is a lot more going on underneath the hood, for example <code>ffmpeg</code> decoding the image and putting it into a <code>numpy</code> array for us. A lot of engineering hours and complexity went into making the API&#39;s so simple and easy to use while remaining fast. It&#39;s great for the Python user with an interface that is as close to English pseudo code as possible, but what if you wanted to build your own library to operate efficiently on numpy arrays?</p><p>You&#39;re going to have to know about:</p><ul><li>The C/C++ programming languages</li><li>The Python <a href="https://docs.python.org/3/c-api/index.html" target="_blank" rel="noopener noreferrer">C API</a></li><li>The <a href="https://numpy.org/doc/stable/reference/c-api/index.html" target="_blank" rel="noopener noreferrer">NumPy C API</a>,</li><li>How NumPy does <a href="https://numpy.org/doc/stable/reference/simd/index.html" target="_blank" rel="noopener noreferrer">CPU/SIMD optimizations</a></li><li>How to <a href="https://numpy.org/doc/stable/user/basics.interoperability.html" target="_blank" rel="noopener noreferrer">Interop with NumPy</a></li></ul><p>And if you&#39;re doing anything with linear algebra:</p><ul><li>The Fortran programming language</li><li><a href="https://www.netlib.org/blas/" target="_blank" rel="noopener noreferrer">BLAS</a></li><li><a href="https://www.netlib.org/lapack/" target="_blank" rel="noopener noreferrer">LAPACK</a></li></ul><p>Making your way down the stack to the actual Fortran routines requires many layers of indirection and is a daunting task. With Mojo we can learn one simple programming model that applies to CPU&#39;s, GPU&#39;s and even TPU&#39;s to replace all that complexity.</p><h2 id="pointing-to-a-cpython-object-from-mojo" tabindex="-1"><a class="header-anchor" href="#pointing-to-a-cpython-object-from-mojo"><span>Pointing to a CPython object from Mojo</span></a></h2><p>The standard library is still being built up for Mojo, so sometimes we need to use foreign-looking syntax to interact with <a href="https://mlir.llvm.org/" target="_blank" rel="noopener noreferrer">MLIR</a> for things that haven&#39;t been added yet. Everything in Mojo lowers to MLIR, which is used to generate code for hardware-specific optimizations. It was built by Chris Lattner and his team at Google as a successor to LLVM because it allows the modularity required for ML and exotic hardware types. Since then it was open sourced with wide adoption and absorbed into the LLVM project. It still uses the legacy LLVM infrastructure for CPU codegen and optimization.</p><p>There is nothing in the standard library yet for converting a Python integer representing an address to a Mojo pointer with a given data type, so for now we need to write our own function:</p><div class="language-mojo" data-highlighter="prismjs" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-mojo;"><code><span class="line"><span class="line"><span style="color:#BB9AF7;">fn</span><span style="color:#7AA2F7;"> numpy_data_pointer</span><span style="color:#9ABDF5;">(</span><span style="color:#E0AF68;">numpy_array</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> PythonObject</span><span style="color:#9ABDF5;">)</span><span style="color:#9D7CD8;font-style:italic;"> raises</span><span style="color:#89DDFF;"> -&gt;</span><span style="color:#A9B1D6;"> DTypePointer</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint32</span><span style="color:#9ABDF5;">]:</span></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">    return</span><span style="color:#A9B1D6;"> DTypePointer</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint32</span><span style="color:#9ABDF5;">](</span></span></span>
<span class="line"><span class="line"><span style="color:#0DB9D7;">                __mlir_op</span><span style="color:#89DDFF;">.</span><span style="color:#9ECE6A;">\`pop.index_to_pointer\`</span><span style="color:#89DDFF;">[</span></span></span>
<span class="line"><span class="line"><span style="color:#7AA2F7;">                    _type=</span><span style="color:#0DB9D7;">__mlir_type</span><span style="color:#89DDFF;">.</span><span style="color:#9ECE6A;">\`!kgen.pointer&lt;scalar&lt;ui32&gt;&gt;\`</span></span></span>
<span class="line"><span class="line"><span style="color:#89DDFF;">                ]</span><span style="color:#9ABDF5;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#FF9E64;">                    SIMD</span><span style="color:#9ABDF5;">[</span><span style="color:#C0CAF5;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">index</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;">1</span><span style="color:#9ABDF5;">](</span><span style="color:#C0CAF5;">numpy_array</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">__array_interface__</span><span style="color:#9ABDF5;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#9ECE6A;">data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">[</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">].</span><span style="color:#0DB9D7;">__index__</span><span style="color:#9ABDF5;">())</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">value</span></span></span>
<span class="line"><span class="line"><span style="color:#9ABDF5;">                )</span></span></span>
<span class="line"><span class="line"><span style="color:#9ABDF5;">            )</span></span></span></code></pre></div><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>In the comments below, an AI compiler engineer working on Mojo suggests they&#39;ll add a static <code>from_address</code> method to make this a lot more simple:</p><div class="language-mojo" data-highlighter="prismjs" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-mojo;"><code><span class="line"><span class="line"><span style="color:#51597D;font-style:italic;"># md-notebook:skip</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">let</span><span style="color:#C0CAF5;"> p</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> DTypePointer</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint32</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">from_address</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">arr</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">__array_interface__</span><span style="color:#9ABDF5;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#9ECE6A;">data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">[</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">]</span><span style="color:#9ABDF5;">)</span></span></span></code></pre></div></div><p>You can see <code>pop</code> is an MLIR dialect the Modular team have developed; it&#39;s not intended for normal programmers to need to understand this syntax, and over time useful things will be wrapped in a nice API by compiler engineers for systems engineers and Python programmers to use at a higher level. But you still have the power to define your own dialects or use one of the many already defined in the MLIR ecosystem, which makes it easy for vendors to accelerate their hardware, for example you can take a look at the <a href="https://mlir.llvm.org/docs/Dialects/GPU/" target="_blank" rel="noopener noreferrer">gpu dialect</a> here. This enables compiler engineers to write optimizations for different hardware as it becomes more exotic for AI acceleration, and Mojo developers will be able to take full advantage.</p><p>Lets go line by line to explain what&#39;s happening:</p><div class="language-mojo" data-highlighter="prismjs" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-mojo;"><code><span class="line"><span class="line"><span style="color:#51597D;font-style:italic;"># md-notebook:skip</span></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">fn</span><span style="color:#7AA2F7;"> numpy_array_pointer</span><span style="color:#9ABDF5;">(</span><span style="color:#E0AF68;">numpy_array</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> PythonObject</span><span style="color:#9ABDF5;">)</span><span style="color:#9D7CD8;font-style:italic;"> raises</span><span style="color:#89DDFF;"> -&gt;</span><span style="color:#A9B1D6;"> DTypePointer</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint32</span><span style="color:#9ABDF5;">]:</span></span></span></code></pre></div>`,58)),n("p",null,[s[1]||(s[1]=n("code",null,"PythonObject",-1)),s[2]||(s[2]=a(" has the same representation in Mojo as it does in Python, see ")),l(e,{to:"/guides/intro-to-mojo/basic-types.html"},{default:i(()=>s[0]||(s[0]=[a("Intro to Mojo: Basic Types")])),_:1}),s[3]||(s[3]=a(" for more details. ")),s[4]||(s[4]=n("code",null,"raises",-1)),s[5]||(s[5]=a(" means that an error could occur which is always the case when interacting with Python. Here I'm returning a Pointer to a DType of ")),s[6]||(s[6]=n("code",null,"uint32",-1)),s[7]||(s[7]=a(" so each element represents the RGBA of a single pixel."))]),s[9]||(s[9]=o(`<div class="language-mojo" data-highlighter="prismjs" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-mojo;"><code><span class="line"><span class="line"><span style="color:#51597D;font-style:italic;"># md-notebook:skip</span></span></span>
<span class="line"><span class="line"><span style="color:#0DB9D7;">__mlir_op</span><span style="color:#89DDFF;">.</span><span style="color:#9ECE6A;">\`pop.index_to_pointer\`</span><span style="color:#89DDFF;">[</span></span></span></code></pre></div><p>This is the operation to convert from an index which is an integer of size that matches your architecture, for example 64bit on an x86-64 machine, to an address that can be used as a pointer.</p><div class="language-mojo" data-highlighter="prismjs" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-mojo;"><code><span class="line"><span class="line"><span style="color:#51597D;font-style:italic;"># md-notebook:skip</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">_type</span><span style="color:#89DDFF;">:</span><span style="color:#0DB9D7;">__mlir_type</span><span style="color:#89DDFF;">.</span><span style="color:#9ECE6A;">\`!pop.pointer&lt;scalar&lt;ui32&gt;&gt;&gt;\`</span></span></span></code></pre></div><p>This is the type as represented in MLIR, it&#39;s 32bits so each element encompasses 4*8bit color channels representing RGBA.</p><div class="language-mojo" data-highlighter="prismjs" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-mojo;"><code><span class="line"><span class="line"><span style="color:#51597D;font-style:italic;"># md-notebook:skip</span></span></span>
<span class="line"><span class="line"><span style="color:#FF9E64;">SIMD</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">index</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;">1</span><span style="color:#9ABDF5;">](</span><span style="color:#7AA2F7;">numpy_array</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">__array_interface__</span><span style="color:#9ABDF5;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#9ECE6A;">data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">[</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">].</span><span style="color:#0DB9D7;">__index__</span><span style="color:#9ABDF5;">())</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">value</span></span></span></code></pre></div><p>Let&#39;s split the above into three separate parts:</p><div class="language-mojo" data-highlighter="prismjs" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-mojo;"><code><span class="line"><span class="line"><span style="color:#51597D;font-style:italic;"># md-notebook:skip</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">numpy_array</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">__array_interface__</span><span style="color:#9ABDF5;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#9ECE6A;">data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">[</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">]</span></span></span></code></pre></div><p>This is using the Python interpreter to get back the address of where the raw data of the numpy array starts in memory.</p><div class="language-mojo" data-highlighter="prismjs" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-mojo;"><code><span class="line"><span class="line"><span style="color:#51597D;font-style:italic;"># md-notebook:skip</span></span></span>
<span class="line"><span class="line"><span style="color:#89DDFF;">.</span><span style="color:#0DB9D7;">__index__</span><span style="color:#9ABDF5;">()</span></span></span></code></pre></div><p>This converts it from a PythonObject to a Mojo <code>Int</code></p><div class="language-mojo" data-highlighter="prismjs" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-mojo;"><code><span class="line"><span class="line"><span style="color:#51597D;font-style:italic;"># md-notebook:skip</span></span></span>
<span class="line"><span class="line"><span style="color:#FF9E64;">SIMD</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">index</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;">1</span><span style="color:#9ABDF5;">](</span><span style="color:#E0AF68;">...</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">value</span></span></span></code></pre></div><p>This gets us back a raw MLIR <code>scalar&lt;index&gt;</code> type which can then be converted to a <code>pointer&lt;scalar&lt;ui32&gt;&gt;&gt;</code> type via the MLIR operation.</p><div class="language-mojo" data-highlighter="prismjs" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-mojo;"><code><span class="line"><span class="line"><span style="color:#51597D;font-style:italic;"># md-notebook:skip</span></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">return</span><span style="color:#A9B1D6;"> DTypePointer</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint32</span><span style="color:#9ABDF5;">](</span><span style="color:#E0AF68;">...</span><span style="color:#9ABDF5;">)</span></span></span></code></pre></div><p>Finally it&#39;s returned as the desired type, which is a Mojo pointer starting at the address in memory where the raw data of the numpy array starts.</p><h2 id="writing-the-box-blur-in-mojo" tabindex="-1"><a class="header-anchor" href="#writing-the-box-blur-in-mojo"><span>Writing the Box Blur in Mojo</span></a></h2><p>Below we&#39;re taking advantage of Mojo&#39;s builtin SIMD type, we figure out how many 32bit pixels we can operate on at once in the hardwares SIMD register, then for each pixel we accumulate the RGB values in a box around it and apply the average to give the blur effect. For example if our SIMD register is 512bits we can operate on 16 32bit pixels at once:</p><div class="language-mojo" data-highlighter="prismjs" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-mojo;"><code><span class="line"><span class="line"><span style="color:#7DCFFF;">from</span><span style="color:#A9B1D6;"> memory </span><span style="color:#7DCFFF;">import</span><span style="color:#A9B1D6;"> memcpy</span></span></span>
<span class="line"><span class="line"><span style="color:#7DCFFF;">from</span><span style="color:#A9B1D6;"> time </span><span style="color:#7DCFFF;">import</span><span style="color:#A9B1D6;"> now</span></span></span>
<span class="line"><span class="line"><span style="color:#7DCFFF;">from</span><span style="color:#A9B1D6;"> math </span><span style="color:#7DCFFF;">import</span><span style="color:#A9B1D6;"> clamp</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">fn</span><span style="color:#7AA2F7;"> box_blur_mojo</span><span style="color:#9ABDF5;">[</span><span style="color:#E0AF68;">diameter</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> Int</span><span style="color:#9ABDF5;">](</span><span style="color:#E0AF68;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> PythonObject</span><span style="color:#9ABDF5;">)</span><span style="color:#9D7CD8;font-style:italic;"> raises</span><span style="color:#9ABDF5;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;">    # Get number of elements that fit into your hardwares SIMD register</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">    alias</span><span style="color:#C0CAF5;"> simd_width</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> simdwidthof</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint32</span><span style="color:#9ABDF5;">]()</span></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;">    # The amount of pixels that will be averaged in box around the target pixel</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">    alias</span><span style="color:#C0CAF5;"> pixels</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> diameter </span><span style="color:#89DDFF;">**</span><span style="color:#FF9E64;"> 2</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">    alias</span><span style="color:#C0CAF5;"> radius</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> diameter </span><span style="color:#89DDFF;">//</span><span style="color:#FF9E64;"> 2</span></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;">    # Use the function we defined earlier to point to the numpy arrays raw data</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">    var</span><span style="color:#C0CAF5;"> p</span><span style="color:#89DDFF;"> =</span><span style="color:#7AA2F7;"> numpy_data_pointer</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">image</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;">    # Get the numpy dimensions from the Python iterpreter and convert them to Mojo ints</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">    var</span><span style="color:#C0CAF5;"> height</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> image</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">shape</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">0</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">.</span><span style="color:#0DB9D7;">__index__</span><span style="color:#9ABDF5;">()</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">    var</span><span style="color:#C0CAF5;"> width</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> image</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">shape</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">1</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">.</span><span style="color:#0DB9D7;">__index__</span><span style="color:#9ABDF5;">()</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">    var</span><span style="color:#C0CAF5;"> el</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> width </span><span style="color:#89DDFF;">*</span><span style="color:#A9B1D6;"> height</span></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;">    # Because we don&#39;t want blurred pixels influencing the outcome of the next pixel, we allocate a new array</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">    var</span><span style="color:#C0CAF5;"> tmp</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> DTypePointer</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint32</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">alloc</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">el</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">    for</span><span style="color:#A9B1D6;"> y </span><span style="color:#BB9AF7;">in</span><span style="color:#0DB9D7;"> range</span><span style="color:#9ABDF5;">(</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> height</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;">        # Step over the amount of elements we&#39;ll operate on at the same time with SIMD</span></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">        for</span><span style="color:#A9B1D6;"> x </span><span style="color:#BB9AF7;">in</span><span style="color:#0DB9D7;"> range</span><span style="color:#9ABDF5;">(</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> width</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> simd_width</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">            var</span><span style="color:#C0CAF5;"> sum_r</span><span style="color:#89DDFF;"> =</span><span style="color:#FF9E64;"> SIMD</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint32</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> simd_width</span><span style="color:#9ABDF5;">]()</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">            var</span><span style="color:#C0CAF5;"> sum_g</span><span style="color:#89DDFF;"> =</span><span style="color:#FF9E64;"> SIMD</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint32</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> simd_width</span><span style="color:#9ABDF5;">]()</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">            var</span><span style="color:#C0CAF5;"> sum_b</span><span style="color:#89DDFF;"> =</span><span style="color:#FF9E64;"> SIMD</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint32</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> simd_width</span><span style="color:#9ABDF5;">]()</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;">            # Loop through a box around the pixel</span></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">            for</span><span style="color:#A9B1D6;"> ky </span><span style="color:#BB9AF7;">in</span><span style="color:#0DB9D7;"> range</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">-</span><span style="color:#C0CAF5;">radius</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> radius</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">                for</span><span style="color:#A9B1D6;"> kx </span><span style="color:#BB9AF7;">in</span><span style="color:#0DB9D7;"> range</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">-</span><span style="color:#C0CAF5;">radius</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> radius</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;">                    # Make sure to not go out of bounds</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">                    var</span><span style="color:#C0CAF5;"> iy</span><span style="color:#89DDFF;"> =</span><span style="color:#7AA2F7;"> clamp</span><span style="color:#9ABDF5;">(</span><span style="color:#7AA2F7;">Int64</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">y</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;"> +</span><span style="color:#C0CAF5;"> ky</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> height</span><span style="color:#89DDFF;">-</span><span style="color:#FF9E64;">1</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">                    var</span><span style="color:#C0CAF5;"> ix</span><span style="color:#89DDFF;"> =</span><span style="color:#7AA2F7;"> clamp</span><span style="color:#9ABDF5;">(</span><span style="color:#7AA2F7;">Int64</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;"> +</span><span style="color:#C0CAF5;"> kx</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> width</span><span style="color:#89DDFF;">-</span><span style="color:#FF9E64;">1</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;">                    # Grab the amount of 32bit RGBA pixels that can fit into your hardwares SIMD register</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">                    var</span><span style="color:#C0CAF5;"> rgb</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> p</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">load</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">width=simd_width</span><span style="color:#9ABDF5;">](</span><span style="color:#7AA2F7;">iy</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">to_int</span><span style="color:#9ABDF5;">()</span><span style="color:#89DDFF;"> *</span><span style="color:#7AA2F7;"> width </span><span style="color:#89DDFF;">+</span><span style="color:#7AA2F7;"> ix</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">to_int</span><span style="color:#9ABDF5;">())</span></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;">                    # and seperate out the RGB components using bit shifts and masking, adding the values to the sums</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">                    sum_r </span><span style="color:#89DDFF;">+=</span><span style="color:#A9B1D6;"> rgb </span><span style="color:#BB9AF7;">&amp;</span><span style="color:#FF9E64;"> SIMD</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint32</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> simd_width</span><span style="color:#9ABDF5;">](</span><span style="color:#FF9E64;">255</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">                    sum_g </span><span style="color:#89DDFF;">+=</span><span style="color:#A9B1D6;"> rgb </span><span style="color:#BB9AF7;">&gt;&gt;</span><span style="color:#FF9E64;"> 8</span><span style="color:#BB9AF7;"> &amp;</span><span style="color:#FF9E64;"> SIMD</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint32</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> simd_width</span><span style="color:#9ABDF5;">](</span><span style="color:#FF9E64;">255</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">                    sum_b </span><span style="color:#89DDFF;">+=</span><span style="color:#A9B1D6;"> rgb </span><span style="color:#BB9AF7;">&gt;&gt;</span><span style="color:#FF9E64;"> 16</span><span style="color:#BB9AF7;"> &amp;</span><span style="color:#FF9E64;"> SIMD</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint32</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> simd_width</span><span style="color:#9ABDF5;">](</span><span style="color:#FF9E64;">255</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;">            # Combine 8bit color channels back into 32bit pixel (last channel is alpha 255 for no transparency)</span></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;">            # And divide by total pixels in the box to get the average colors</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">            var</span><span style="color:#C0CAF5;"> combined</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> (</span><span style="color:#A9B1D6;">sum_r </span><span style="color:#89DDFF;">/</span><span style="color:#A9B1D6;"> pixels</span><span style="color:#89DDFF;">)</span><span style="color:#BB9AF7;"> |</span><span style="color:#89DDFF;"> (</span><span style="color:#A9B1D6;">sum_g </span><span style="color:#89DDFF;">/</span><span style="color:#A9B1D6;"> pixels </span><span style="color:#BB9AF7;">&lt;&lt;</span><span style="color:#FF9E64;"> 8</span><span style="color:#89DDFF;">)</span><span style="color:#BB9AF7;"> |</span><span style="color:#89DDFF;"> (</span><span style="color:#A9B1D6;">sum_b </span><span style="color:#89DDFF;">/</span><span style="color:#A9B1D6;"> pixels </span><span style="color:#BB9AF7;">&lt;&lt;</span><span style="color:#FF9E64;"> 16</span><span style="color:#89DDFF;">)</span><span style="color:#BB9AF7;"> |</span><span style="color:#89DDFF;">  (</span><span style="color:#FF9E64;">255</span><span style="color:#BB9AF7;"> &lt;&lt;</span><span style="color:#FF9E64;"> 24</span><span style="color:#89DDFF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;">            # Store all the pixels at once (16 on a 512bit SIMD register)</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">            tmp</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">store</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">y </span><span style="color:#89DDFF;">*</span><span style="color:#C0CAF5;"> width </span><span style="color:#89DDFF;">+</span><span style="color:#C0CAF5;"> x</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> combined</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;">    # Copy the data from the temporay image to the original numpy array</span></span></span>
<span class="line"><span class="line"><span style="color:#7AA2F7;">    memcpy</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">p</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> tmp</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> el</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">    tmp</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">free</span><span style="color:#9ABDF5;">()</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">var</span><span style="color:#C0CAF5;"> image</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> py</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">open_img</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">fire.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">box_blur_mojo</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">8</span><span style="color:#9ABDF5;">](</span><span style="color:#7AA2F7;">image</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">py</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">write_img</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">mojo-blur.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> image</span><span style="color:#9ABDF5;">)</span></span></span></code></pre></div><img src="`+h+`" width="200"><h2 id="vectorize" tabindex="-1"><a class="header-anchor" href="#vectorize"><span>Vectorize</span></a></h2><p>You may have noticed a bug: if the image width isn&#39;t a multiple of our SIMD register, we&#39;ll have some leftover pixels that don&#39;t get blurred. Mojo includes a vectorize function because it&#39;s such a common requirement to load chunks of data that fit into the SIMD register, and it accounts for any leftovers without us having to calculate that ourselves:</p><div class="language-mojo" data-highlighter="prismjs" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-mojo;"><code><span class="line"><span class="line"><span style="color:#7DCFFF;">from</span><span style="color:#A9B1D6;"> algorithm </span><span style="color:#7DCFFF;">import</span><span style="color:#A9B1D6;"> vectorize</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">fn</span><span style="color:#7AA2F7;"> box_blur_vectorize_mojo</span><span style="color:#9ABDF5;">[</span><span style="color:#E0AF68;">diameter</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> Int</span><span style="color:#9ABDF5;">](</span><span style="color:#E0AF68;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> PythonObject</span><span style="color:#9ABDF5;">)</span><span style="color:#9D7CD8;font-style:italic;"> raises</span><span style="color:#9ABDF5;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">    alias</span><span style="color:#C0CAF5;"> simd_width</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> simdwidthof</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint32</span><span style="color:#9ABDF5;">]()</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">    alias</span><span style="color:#C0CAF5;"> pixels</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> diameter </span><span style="color:#89DDFF;">**</span><span style="color:#FF9E64;"> 2</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">    alias</span><span style="color:#C0CAF5;"> radius</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> diameter </span><span style="color:#89DDFF;">//</span><span style="color:#FF9E64;"> 2</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">    var</span><span style="color:#C0CAF5;"> p</span><span style="color:#89DDFF;"> =</span><span style="color:#7AA2F7;"> numpy_data_pointer</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">image</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">    var</span><span style="color:#C0CAF5;"> height</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> image</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">shape</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">0</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">.</span><span style="color:#0DB9D7;">__index__</span><span style="color:#9ABDF5;">()</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">    var</span><span style="color:#C0CAF5;"> width</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> image</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">shape</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">1</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">.</span><span style="color:#0DB9D7;">__index__</span><span style="color:#9ABDF5;">()</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">    var</span><span style="color:#C0CAF5;"> el</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> width </span><span style="color:#89DDFF;">*</span><span style="color:#A9B1D6;"> height</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">    var</span><span style="color:#C0CAF5;"> tmp</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> DTypePointer</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint32</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">alloc</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">el</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">    for</span><span style="color:#A9B1D6;"> y </span><span style="color:#BB9AF7;">in</span><span style="color:#0DB9D7;"> range</span><span style="color:#9ABDF5;">(</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> height</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;">        # This inner loop is vectorized by stepping over simd_width pixels (16 32bit pixels on a 512bit SIMD register) </span></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;">        # on the x axis, as we&#39;re loading that amount of pixels and operating on them at the same time</span></span></span>
<span class="line"><span class="line"><span style="color:#89DDFF;">        @</span><span style="color:#7AA2F7;">parameter</span></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">        fn</span><span style="color:#7AA2F7;"> inner</span><span style="color:#9ABDF5;">[</span><span style="color:#E0AF68;">simd_width</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> Int</span><span style="color:#9ABDF5;">](</span><span style="color:#E0AF68;">x</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> Int</span><span style="color:#9ABDF5;">):</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">            var</span><span style="color:#C0CAF5;"> sum_r</span><span style="color:#89DDFF;"> =</span><span style="color:#FF9E64;"> SIMD</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint32</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> simd_width</span><span style="color:#9ABDF5;">]()</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">            var</span><span style="color:#C0CAF5;"> sum_g</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> sum_r</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">            var</span><span style="color:#C0CAF5;"> sum_b</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> sum_r</span></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">            for</span><span style="color:#A9B1D6;"> ky </span><span style="color:#BB9AF7;">in</span><span style="color:#0DB9D7;"> range</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">-</span><span style="color:#C0CAF5;">radius</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> radius</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">                for</span><span style="color:#A9B1D6;"> kx </span><span style="color:#BB9AF7;">in</span><span style="color:#0DB9D7;"> range</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">-</span><span style="color:#C0CAF5;">radius</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> radius</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">                    var</span><span style="color:#C0CAF5;"> iy</span><span style="color:#89DDFF;"> =</span><span style="color:#7AA2F7;"> clamp</span><span style="color:#9ABDF5;">(</span><span style="color:#7AA2F7;">Int64</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">y</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;"> +</span><span style="color:#C0CAF5;"> ky</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> height</span><span style="color:#89DDFF;">-</span><span style="color:#FF9E64;">1</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">                    var</span><span style="color:#C0CAF5;"> ix</span><span style="color:#89DDFF;"> =</span><span style="color:#7AA2F7;"> clamp</span><span style="color:#9ABDF5;">(</span><span style="color:#7AA2F7;">Int64</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;"> +</span><span style="color:#C0CAF5;"> kx</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> width</span><span style="color:#89DDFF;">-</span><span style="color:#FF9E64;">1</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">                    var</span><span style="color:#C0CAF5;"> rgb</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> p</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">load</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">width=simd_width</span><span style="color:#9ABDF5;">](</span><span style="color:#7AA2F7;">iy</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">to_int</span><span style="color:#9ABDF5;">()</span><span style="color:#89DDFF;"> *</span><span style="color:#7AA2F7;"> width </span><span style="color:#89DDFF;">+</span><span style="color:#7AA2F7;"> ix</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">to_int</span><span style="color:#9ABDF5;">())</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">                    sum_r </span><span style="color:#89DDFF;">+=</span><span style="color:#A9B1D6;"> rgb </span><span style="color:#BB9AF7;">&amp;</span><span style="color:#FF9E64;"> 255</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">                    sum_g </span><span style="color:#89DDFF;">+=</span><span style="color:#A9B1D6;"> rgb </span><span style="color:#BB9AF7;">&gt;&gt;</span><span style="color:#FF9E64;"> 8</span><span style="color:#BB9AF7;"> &amp;</span><span style="color:#FF9E64;"> 255</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">                    sum_b </span><span style="color:#89DDFF;">+=</span><span style="color:#A9B1D6;"> rgb </span><span style="color:#BB9AF7;">&gt;&gt;</span><span style="color:#FF9E64;"> 16</span><span style="color:#BB9AF7;"> &amp;</span><span style="color:#FF9E64;"> 255</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">            var</span><span style="color:#C0CAF5;"> combined</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> (</span><span style="color:#A9B1D6;">sum_r </span><span style="color:#89DDFF;">/</span><span style="color:#A9B1D6;"> pixels</span><span style="color:#89DDFF;">)</span><span style="color:#BB9AF7;"> |</span><span style="color:#89DDFF;"> (</span><span style="color:#A9B1D6;">sum_g </span><span style="color:#89DDFF;">/</span><span style="color:#A9B1D6;"> pixels </span><span style="color:#BB9AF7;">&lt;&lt;</span><span style="color:#FF9E64;"> 8</span><span style="color:#89DDFF;">)</span><span style="color:#BB9AF7;"> |</span><span style="color:#89DDFF;"> (</span><span style="color:#A9B1D6;">sum_b </span><span style="color:#89DDFF;">/</span><span style="color:#A9B1D6;"> pixels </span><span style="color:#BB9AF7;">&lt;&lt;</span><span style="color:#FF9E64;"> 16</span><span style="color:#89DDFF;">)</span><span style="color:#BB9AF7;"> |</span><span style="color:#89DDFF;">  (</span><span style="color:#FF9E64;">255</span><span style="color:#BB9AF7;"> &lt;&lt;</span><span style="color:#FF9E64;"> 24</span><span style="color:#89DDFF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">            tmp</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">store</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">y </span><span style="color:#89DDFF;">*</span><span style="color:#C0CAF5;"> width </span><span style="color:#89DDFF;">+</span><span style="color:#C0CAF5;"> x</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> combined</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#51597D;font-style:italic;">        # Run the vectorized inner loop</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">        vectorize</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">inner</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> simd_width</span><span style="color:#9ABDF5;">](</span><span style="color:#7AA2F7;">width</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#7AA2F7;">    memcpy</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">p</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> tmp</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> el</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">    tmp</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">free</span><span style="color:#9ABDF5;">()</span></span></span></code></pre></div><p>Now we can use a similar benchmark function as Python to take the average of 5 iterations:</p><div class="language-mojo" data-highlighter="prismjs" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-mojo;"><code><span class="line"><span class="line"><span style="color:#A9B1D6;">image </span><span style="color:#89DDFF;">=</span><span style="color:#A9B1D6;"> py</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">open_img</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">fire.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">var</span><span style="color:#C0CAF5;"> nanos</span><span style="color:#89DDFF;"> =</span><span style="color:#FF9E64;"> 0.0</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">var</span><span style="color:#C0CAF5;"> its</span><span style="color:#89DDFF;"> =</span><span style="color:#FF9E64;"> 5</span></span></span>
<span class="line"><span class="line"><span style="color:#BB9AF7;">for</span><span style="color:#A9B1D6;"> _ </span><span style="color:#BB9AF7;">in</span><span style="color:#0DB9D7;"> range</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">its</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#9D7CD8;font-style:italic;">    var</span><span style="color:#C0CAF5;"> tick</span><span style="color:#89DDFF;"> =</span><span style="color:#7AA2F7;"> now</span><span style="color:#9ABDF5;">()</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">    box_blur_mojo</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">8</span><span style="color:#9ABDF5;">](</span><span style="color:#7AA2F7;">image</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">    nanos </span><span style="color:#89DDFF;">+=</span><span style="color:#89DDFF;"> (</span><span style="color:#7AA2F7;">now</span><span style="color:#9ABDF5;">()</span><span style="color:#89DDFF;"> -</span><span style="color:#A9B1D6;"> tick</span><span style="color:#89DDFF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#A9B1D6;">mojo_secs </span><span style="color:#89DDFF;">=</span><span style="color:#A9B1D6;"> nanos </span><span style="color:#89DDFF;">/</span><span style="color:#A9B1D6;"> its </span><span style="color:#89DDFF;">/</span><span style="color:#FF9E64;"> 1e9</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">total time:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> mojo_secs</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">python speedup:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> py</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">python_secs </span><span style="color:#89DDFF;">/</span><span style="color:#C0CAF5;"> mojo_secs</span><span style="color:#9ABDF5;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">opencv speedup:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> py</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">opencv_secs </span><span style="color:#89DDFF;">/</span><span style="color:#C0CAF5;"> mojo_secs</span><span style="color:#9ABDF5;">)</span></span></span></code></pre></div><div class="language-text" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6 language-text;"><code><span class="line"><span class="line"><span>total time: 0.00032285000000000001</span></span></span>
<span class="line"><span class="line"><span>python speedup: 663.2885296575425</span></span></span>
<span class="line"><span class="line"><span>opencv speedup: 1.8979340248172347</span></span></span></code></pre></div><p>We just replaced tens of thousands of lines of incredibly hard-to-understand C++ code, accounting for all the different hardware API&#39;s that opencv supports, and still managed to get a 3x performance improvement. This can be further improved by splitting rows and running on separate cores, but this didn&#39;t result in faster performance on my playground instance as the CPU is shared with other users, stay tuned for updates once the local compiler is released.</p><p>This isn&#39;t the most performant way to do a box blur; I chose this method because it&#39;s the fewest lines of code and easiest to explain.</p><h2 id="conclusion" tabindex="-1"><a class="header-anchor" href="#conclusion"><span>Conclusion</span></a></h2><p>Overall I really enjoy working with computer vision and Rust as it&#39;s a fun language, but adding complexity is not going to help the ecosystem, it&#39;s desperately in need of simplification. As <a href="https://www.youtube.com/watch?v=VMj-3S1tku0" target="_blank" rel="noopener noreferrer">Andrej Karpathy shows</a>, neural networks are not complicated to implement, it&#39;s making them go fast on different hardware where all the complexity comes from, and because Mojo is focused on simplifying that process while allowing AI researchers to interact with their code from Python, I&#39;m confident that it&#39;s going to be the path forward for the industry.</p><p>If you found any mistakes, incorrect information, or have faster benchmarks, please let me know in the comments below or <a href="https://github.com/mojodojodev/mojodojo.dev/edit/main/blog/2023-07-17-rust-or-mojo-ai.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> to raise a pull request!</p><p><em>contributions by <a href="https://github.com/rgov" target="_blank" rel="noopener noreferrer">Ryan Govostes</a> and <a href="https://github.com/abduld" target="_blank" rel="noopener noreferrer">Abdul Dakkak</a></em></p>`,30)),l(t)])}const f=r(g,[["render",m],["__file","2023-07-17-rust-or-mojo-ai.html.vue"]]),C=JSON.parse('{"path":"/blog/2023-07-17-rust-or-mojo-ai.html","title":"Rust or Mojo for the future of AI?","lang":"en-US","frontmatter":{"author":"Mojo Dojo","author_site":"https://mojodojo.dev","author_image":"https://mojodojo.dev/hero.png","excerpt":"Comparing the experience of rewriting C/C++/Python with Rust and Mojo","date":"2023-07-17T00:00:00.000Z","feed":true,"head":[["meta",{"name":"twitter:card","content":"summary"}],["meta",{"name":"twitter:site","content":"@mojodojodev"}],["meta",{"name":"twitter:title","content":"Rust or Mojo for the future of AI?"}],["meta",{"name":"twitter:description","content":"Comparing the experience of rewriting C++ and Python with Rust and Mojo"}],["meta",{"name":"twitter:image","content":"https://mojodojo.dev/hero.png"}]]},"headers":[{"level":2,"title":"Intro","slug":"intro","link":"#intro","children":[]},{"level":2,"title":"C++ Dependencies","slug":"c-dependencies","link":"#c-dependencies","children":[]},{"level":2,"title":"C++ from Rust","slug":"c-from-rust","link":"#c-from-rust","children":[]},{"level":2,"title":"Rewriting C/C++/Python with Mojo","slug":"rewriting-c-c-python-with-mojo","link":"#rewriting-c-c-python-with-mojo","children":[]},{"level":2,"title":"Pointing to a CPython object from Mojo","slug":"pointing-to-a-cpython-object-from-mojo","link":"#pointing-to-a-cpython-object-from-mojo","children":[]},{"level":2,"title":"Writing the Box Blur in Mojo","slug":"writing-the-box-blur-in-mojo","link":"#writing-the-box-blur-in-mojo","children":[]},{"level":2,"title":"Vectorize","slug":"vectorize","link":"#vectorize","children":[]},{"level":2,"title":"Conclusion","slug":"conclusion","link":"#conclusion","children":[]}],"git":{"contributors":[{"name":"Mojo Dojo","username":"Mojo Dojo","email":"mojodojodev@gmail.com","commits":1,"url":"https://github.com/Mojo Dojo"},{"name":"Jack Clayton","username":"Jack Clayton","email":"jackos@me.com","commits":2,"url":"https://github.com/Jack Clayton"}]},"filePathRelative":"blog/2023-07-17-rust-or-mojo-ai.md"}');export{f as comp,C as data};
